<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>BIBLE TRACKER PRO</title>
    <style>
        :root {
            --hex-w: 42px; 
            --hex-h: calc(var(--hex-w) * 1.1547);
            --hex-gap: 3px;
            --hex-active: #ffcc00;
            --hex-border: #e5e5ea;
            --bg-page: #f2f2f7;
            --gold-gradient: linear-gradient(145deg, #ffcc00, #ff9500);
            --apple-red: #ff3b30;
            --apple-green: #34c759;
        }

        * { -webkit-tap-highlight-color: transparent; box-sizing: border-box; }

        body {
            background: linear-gradient(180deg, #ffffff 0%, var(--bg-page) 100%);
            margin: 0; font-family: -apple-system, system-ui, sans-serif;
            display: flex; flex-direction: column; align-items: center; min-height: 100vh; color: #1c1c1e;
        }

        header {
            width: 100%; background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(20px);
            position: sticky; top: 0; z-index: 1000; padding: 12px 0; border-bottom: 0.5px solid rgba(0,0,0,0.1);
        }

        .stats-container { text-align: center; margin-bottom: 8px; }
        .total-stats { font-size: 10px; font-weight: 800; color: #ff9500; text-transform: uppercase; letter-spacing: 1.2px; }
        .streak-info { font-size: 10px; font-weight: 800; color: var(--apple-green); text-transform: uppercase; margin-top: 2px; }

        .nav-header { display: flex; align-items: center; justify-content: space-between; padding: 0 15px; max-width: 600px; margin: 0 auto; }
        .menu-btn { background: none; border: none; font-size: 10px; font-weight: 800; color: #8e8e93; cursor: pointer; text-transform: uppercase; padding: 10px; }
        .book-title { font-size: 18px; font-weight: 900; text-transform: uppercase; color: #000; flex-grow: 1; text-align: center; }

        .menu-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 255, 255, 0.98); z-index: 2000; display: none; flex-direction: column; padding: 60px 20px 20px; overflow-y: auto;
        }

        .filter-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding: 10px; background: #f2f2f7; border-radius: 12px; }
        .filter-label { font-size: 10px; font-weight: 800; color: #8e8e93; text-transform: uppercase; }
        
        .toggle-switch { position: relative; display: inline-block; width: 40px; height: 22px; }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #d1d1d6; transition: .4s; border-radius: 20px; }
        .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 2px; bottom: 2px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--apple-green); }
        input:checked + .slider:before { transform: translateX(18px); }

        .menu-list { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .menu-item {
            padding: 16px 10px; border-radius: 16px; background: #f2f2f7; text-align: center;
            font-size: 11px; font-weight: 800; color: #1c1c1e; text-transform: uppercase;
            display: flex; flex-direction: column; transition: all 0.2s ease; border: 1px solid transparent;
        }
        
        /* –¶–≤–µ—Ç–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π –∫–Ω–∏–≥ */
        .menu-item.in-progress { background: var(--gold-gradient); color: #fff; border: none; }
        .menu-item.in-progress span { color: rgba(255,255,255,0.9) !important; }
        
        .menu-item.completed { border: 1px solid var(--apple-green); background: #f2f2f7; opacity: 0.6; }
        .menu-item.completed span { color: var(--apple-green) !important; }

        .menu-item:active { transform: scale(0.96); }
        .menu-item span { font-size: 9px; opacity: 0.6; margin-top: 4px; font-weight: 700; }

        .app-container {
            background: #ffffff; margin: 20px 15px; padding: 40px 15px;
            border-radius: 35px; box-shadow: 0 10px 40px rgba(0,0,0,0.03);
            display: flex; flex-direction: column; align-items: center; min-height: 300px;
        }

        .grid-wrapper { line-height: 0; display: inline-block; transition: opacity 0.3s; }
        .hex-row { white-space: nowrap; margin-top: calc(var(--hex-h) * -0.26); display: block; }
        .hex-row:nth-child(even) { margin-left: calc(var(--hex-w) / 2 + var(--hex-gap) + 1px); }

        .hexagon {
            width: var(--hex-w); height: var(--hex-h); display: inline-block; margin: var(--hex-gap);
            position: relative; background: var(--hex-border);
            clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);
        }
        .hexagon.animate { animation: hexPop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; opacity: 0; }
        @keyframes hexPop { from { opacity: 0; transform: scale(0); } to { opacity: 1; transform: scale(1); } }

        .hexagon-inner {
            position: absolute; top: 1.5px; left: 1.5px; right: 1.5px; bottom: 1.5px;
            background: #ffffff; clip-path: inherit; display: flex; align-items: center; justify-content: center;
            font-size: 13px; font-weight: 700; transition: all 0.3s ease;
        }

        .checked .hexagon-inner { background: var(--gold-gradient); color: #ffffff; }

        .info-panel { margin-top: 15px; text-align: center; padding-bottom: 40px; }
        .reset-btn { color: var(--apple-red); font-size: 9px; font-weight: 800; border: none; background: none; cursor: pointer; opacity: 0.3; text-transform: uppercase; padding: 10px;}
        
        .empty-msg { font-size: 12px; color: #8e8e93; text-align: center; grid-column: span 2; padding: 40px; font-weight: 600; }
    </style>
</head>
<body>

    <div class="menu-overlay" id="old-menu">
        <button onclick="toggleMenu('old-menu')" style="position:fixed; top:20px; right:20px; border:none; background:none; font-size:24px;">‚úï</button>
        <div class="filter-bar">
            <div class="filter-label">–°–∫—Ä—ã—Ç—å –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ</div>
            <label class="toggle-switch">
                <input type="checkbox" id="hide-old" onchange="toggleFilter()">
                <span class="slider"></span>
            </label>
        </div>
        <div class="menu-list" id="old-list"></div>
    </div>

    <div class="menu-overlay" id="new-menu">
        <button onclick="toggleMenu('new-menu')" style="position:fixed; top:20px; right:20px; border:none; background:none; font-size:24px;">‚úï</button>
        <div class="filter-bar">
            <div class="filter-label">–°–∫—Ä—ã—Ç—å –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ</div>
            <label class="toggle-switch">
                <input type="checkbox" id="hide-new" onchange="toggleFilter()">
                <span class="slider"></span>
            </label>
        </div>
        <div class="menu-list" id="new-list"></div>
    </div>

    <header>
        <div class="stats-container">
            <div class="total-stats" id="total-stats">–ü–†–û–ì–†–ï–°–°: 0 / 1189</div>
            <div class="streak-info" id="streak-info">–£–î–ê–†–ù–´–ô –†–ï–ñ–ò–ú: 0 –î–ù–ï–ô</div>
        </div>
        <div class="nav-header">
            <button class="menu-btn" onclick="toggleMenu('old-menu')">–≤–µ—Ç—Ö–∏–π</button>
            <div class="book-title" id="book-name">–ë–´–¢–ò–ï</div>
            <button class="menu-btn" onclick="toggleMenu('new-menu')">–Ω–æ–≤—ã–π</button>
        </div>
    </header>

    <div class="app-container">
        <div class="grid-wrapper" id="grid"></div>
    </div>

    <div class="info-panel">
        <div id="info-text" style="font-size:11px; font-weight:700; color:#8e8e93; text-transform:uppercase;">–≤—ã–±–µ—Ä–∏—Ç–µ –≥–ª–∞–≤—É</div>
        <button class="reset-btn" onclick="resetBook()">–°–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –∫–Ω–∏–≥–∏</button>
    </div>

    <script>
        const oldT = [{n:'–ë–´–¢–ò–ï', c:50, id:'gen'},{n:'–ò–°–•–û–î', c:40, id:'exo'},{n:'–õ–ï–í–ò–¢', c:27, id:'lev'},{n:'–ß–ò–°–õ–ê', c:36, id:'num'},{n:'–í–¢–û–†–û–ó–ê–ö–û–ù–ò–ï', c:34, id:'deu'},{n:'–ò–ò–°–£–° –ù–ê–í–ò–ù', c:24, id:'jos'},{n:'–°–£–î–¨–ò', c:21, id:'jdg'},{n:'–†–£–§–¨', c:4, id:'rut'},{n:'1 –¶–ê–†–°–¢–í', c:31, id:'1sa'},{n:'2 –¶–ê–†–°–¢–í', c:24, id:'2sa'},{n:'3 –¶–ê–†–°–¢–í', c:22, id:'1ki'},{n:'4 –¶–ê–†–°–¢–í', c:25, id:'2ki'},{n:'1 –ü–ê–†–ê–õ–ò–ü–û–ú–ï–ù–û–ù', c:29, id:'1ch'},{n:'2 –ü–ê–†–ê–õ–ò–ü–û–ú–ï–ù–û–ù', c:36, id:'2ch'},{n:'–ï–ó–î–†–ê', c:10, id:'ezr'},{n:'–ù–ï–ï–ú–ò–Ø', c:13, id:'neh'},{n:'–ï–°–§–ò–†–¨', c:10, id:'est'},{n:'–ò–û–í', c:42, id:'job'},{n:'–ü–°–ê–õ–¢–ò–†–¨', c:150, id:'psa'},{n:'–ü–†–ò–¢–ß–ò', c:31, id:'pro'},{n:'–ï–ö–ö–õ–ï–°–ò–ê–°–¢', c:12, id:'ecc'},{n:'–ü–ï–°–ù–Ø –ü–ï–°–ù–ï–ô', c:8, id:'sng'},{n:'–ò–°–ê–ò–Ø', c:66, id:'isa'},{n:'–ò–ï–†–ï–ú–ò–Ø', c:52, id:'jer'},{n:'–ü–õ–ê–ß –ò–ï–†–ï–ú–ò–ò', c:5, id:'lam'},{n:'–ò–ï–ó–ï–ö–ò–ò–õ–¨', c:48, id:'ezk'},{n:'–î–ê–ù–ò–ò–õ', c:12, id:'dan'},{n:'–û–°–ò–Ø', c:14, id:'hos'},{n:'–ò–û–ò–õ–¨', c:3, id:'jol'},{n:'–ê–ú–û–°', c:9, id:'amo'},{n:'–ê–í–î–ò–ô', c:1, id:'oba'},{n:'–ò–û–ù–ê', c:4, id:'jon'},{n:'–ú–ò–•–ï–ô', c:7, id:'mic'},{n:'–ù–ê–£–ú', c:3, id:'nam'},{n:'–ê–í–í–ê–ö–£–ú', c:3, id:'hab'},{n:'–°–û–§–û–ù–ò–Ø', c:3, id:'zep'},{n:'–ê–ì–ì–ï–ô', c:2, id:'hag'},{n:'–ó–ê–•–ê–†–ò–Ø', c:14, id:'zec'},{n:'–ú–ê–õ–ê–•–ò–Ø', c:4, id:'mal'}];
        const newT = [{n:'–ú–ê–¢–§–ï–Ø', c:28, id:'mat'},{n:'–ú–ê–†–ö–ê', c:16, id:'mrk'},{n:'–õ–£–ö–ò', c:24, id:'luk'},{n:'–ò–û–ê–ù–ù–ê', c:21, id:'jhn'},{n:'–î–ï–Ø–ù–ò–Ø', c:28, id:'act'},{n:'–†–ò–ú–õ–Ø–ù–ê–ú', c:16, id:'rom'},{n:'1 –ö–û–†–ò–ù–§–Ø–ù–ê–ú', c:16, id:'1co'},{n:'2 –ö–û–†–ò–ù–§–Ø–ù–ê–ú', c:13, id:'2co'},{n:'–ì–ê–õ–ê–¢–ê–ú', c:6, id:'gal'},{n:'–ï–§–ï–°–Ø–ù–ê–ú', c:6, id:'eph'},{n:'–§–ò–õ–ò–ü–ü–ò–ô–¶–ê–ú', c:4, id:'php'},{n:'–ö–û–õ–û–°–°–Ø–ù–ê–ú', c:4, id:'col'},{n:'1 –§–ï–°–°–ê–õ–û–ù–ò–ö–ò–ô–¶–ê–ú', c:5, id:'1th'},{n:'2 –§–ï–°–°–ê–õ–û–ù–ò–ö–ò–ô–¶–ê–ú', c:3, id:'2th'},{n:'1 –¢–ò–ú–û–§–ï–Æ', c:6, id:'1ti'},{n:'2 –¢–ò–ú–û–§–ï–Æ', c:4, id:'2ti'},{n:'–¢–ò–¢–£', c:3, id:'tit'},{n:'–§–ò–õ–ò–ú–û–ù–£', c:1, id:'phm'},{n:'–ï–í–†–ï–Ø–ú', c:13, id:'heb'},{n:'–ò–ê–ö–û–í–ê', c:5, id:'jas'},{n:'1 –ü–ï–¢–†–ê', c:5, id:'1pe'},{n:'2 –ü–ï–¢–†–ê', c:3, id:'2pe'},{n:'1 –ò–û–ê–ù–ù–ê', c:5, id:'1jn'},{n:'2 –ò–û–ê–ù–ù–ê', c:1, id:'2jn'},{n:'3 –ò–û–ê–ù–ù–ê', c:1, id:'3jn'},{n:'–ò–£–î–´', c:1, id:'jud'},{n:'–û–¢–ö–†–û–í–ï–ù–ò–ï', c:22, id:'rev'}];

        let currentB = JSON.parse(localStorage.getItem('last_book')) || oldT[0];
        let hideCompleted = localStorage.getItem('hide_completed') === 'true';

        function toggleMenu(id) {
            const m = document.getElementById(id);
            const isOpen = m.style.display === 'flex';
            m.style.display = isOpen ? 'none' : 'flex';
            if(!isOpen) {
                document.getElementById('hide-old').checked = hideCompleted;
                document.getElementById('hide-new').checked = hideCompleted;
                updateUIStats();
            }
        }

        function toggleFilter() {
            hideCompleted = !hideCompleted;
            localStorage.setItem('hide_completed', hideCompleted);
            updateUIStats();
        }

        function updateStreak() {
            const history = JSON.parse(localStorage.getItem('read_history') || "[]");
            if (history.length === 0) return 0;
            const dates = [...new Set(history)].sort().reverse();
            let today = new Date().toISOString().split('T')[0];
            let yesterday = new Date(); yesterday.setDate(yesterday.getDate() - 1);
            yesterday = yesterday.toISOString().split('T')[0];
            if (dates[0] !== today && dates[0] !== yesterday) return 0;
            let streak = 0;
            let check = dates[0] === today ? new Date() : new Date(yesterday);
            for (let d of dates) {
                if (d === check.toISOString().split('T')[0]) {
                    streak++; check.setDate(check.getDate() - 1);
                } else break;
            }
            return streak;
        }

        function logActivity() {
            const today = new Date().toISOString().split('T')[0];
            let history = JSON.parse(localStorage.getItem('read_history') || "[]");
            if (!history.includes(today)) {
                history.push(today);
                localStorage.setItem('read_history', JSON.stringify(history));
            }
        }

        function updateUIStats() {
            let total = 0;
            [...oldT, ...newT].forEach(b => {
                const saved = JSON.parse(localStorage.getItem('bible_v3_' + b.id)) || [];
                const count = saved.length;
                const percent = Math.round((count / b.c) * 100);
                total += count;
                
                const item = document.getElementById('item-' + b.id);
                if(item) {
                    const isDone = count === b.c;
                    const isStarted = count > 0 && !isDone;
                    item.classList.remove('completed', 'in-progress');
                    if (isDone) item.classList.add('completed');
                    else if (isStarted) item.classList.add('in-progress');
                    item.style.display = (hideCompleted && isDone) ? 'none' : 'flex';
                    document.getElementById(`cnt-${b.id}`).innerText = `${count} / ${b.c} ‚Ä¢ ${percent}%`;
                }
            });
            checkEmpty('old-list', oldT);
            checkEmpty('new-list', newT);
            document.getElementById('total-stats').innerText = `–ü–†–û–ì–†–ï–°–°: ${total} / 1189`;
            document.getElementById('streak-info').innerText = `–£–î–ê–†–ù–´–ô –†–ï–ñ–ò–ú: ${updateStreak()} –î–ù–ï–ô`;
        }

        function checkEmpty(listId, books) {
            const container = document.getElementById(listId);
            const visible = books.filter(b => {
                const saved = JSON.parse(localStorage.getItem('bible_v3_' + b.id)) || [];
                return !(hideCompleted && saved.length === b.c);
            });
            const oldMsg = container.querySelector('.empty-msg');
            if (visible.length === 0) {
                if (!oldMsg) {
                    const msg = document.createElement('div');
                    msg.className = 'empty-msg';
                    msg.innerText = "–í—Å–µ –∫–Ω–∏–≥–∏ –ø—Ä–æ—á–∏—Ç–∞–Ω—ã! üéâ";
                    container.appendChild(msg);
                }
            } else if (oldMsg) oldMsg.remove();
        }

        function build() {
            const lists = { 'old-list': oldT, 'new-list': newT };
            for (let id in lists) {
                const container = document.getElementById(id);
                container.innerHTML = '';
                lists[id].forEach(b => {
                    const d = document.createElement('div');
                    d.className = 'menu-item'; d.id = 'item-' + b.id;
                    d.innerHTML = `${b.n} <span id="cnt-${b.id}">0 / ${b.c} ‚Ä¢ 0%</span>`;
                    d.onclick = () => {
                        currentB = b; localStorage.setItem('last_book', JSON.stringify(b));
                        toggleMenu(id.replace('-list','-menu')); render();
                    };
                    container.appendChild(d);
                });
            }
        }

        function render() {
            document.getElementById('book-name').innerText = currentB.n;
            const g = document.getElementById('grid'); g.style.opacity = '0';
            setTimeout(() => {
                g.innerHTML = '';
                const saved = JSON.parse(localStorage.getItem('bible_v3_' + currentB.id)) || [];
                for (let i = 0; i < currentB.c; i += 7) {
                    const row = document.createElement('div'); row.className = 'hex-row';
                    for(let j=1; j<=7 && (i+j)<=currentB.c; j++) {
                        const num = i+j;
                        const h = document.createElement('div');
                        h.className = 'hexagon animate' + (saved.includes(num) ? ' checked' : '');
                        h.style.animationDelay = (j * 0.04) + 's';
                        h.innerHTML = `<div class="hexagon-inner">${num}</div>`;
                        h.onclick = () => {
                            if (window.navigator.vibrate) window.navigator.vibrate(15);
                            let p = JSON.parse(localStorage.getItem('bible_v3_' + currentB.id)) || [];
                            if(h.classList.toggle('checked')) { p.push(num); logActivity(); }
                            else p = p.filter(x => x !== num);
                            localStorage.setItem('bible_v3_' + currentB.id, JSON.stringify(p));
                            updateUIStats();
                        };
                        row.appendChild(h);
                    }
                    g.appendChild(row);
                }
                g.style.opacity = '1';
                updateUIStats();
            }, 150);
        }

        function resetBook() {
            if(confirm('–°–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å —ç—Ç–æ–π –∫–Ω–∏–≥–∏?')) { 
                localStorage.removeItem('bible_v3_'+currentB.id); render(); 
            }
        }

        build(); render();
    </script>
</body>
</html>