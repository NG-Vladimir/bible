<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>BIBLE TRACKER PRO</title>
    <style>
        :root {
            --hex-w: 42px; 
            --hex-h: calc(var(--hex-w) * 1.1547);
            --hex-gap: 3px;
            --hex-active: #ffcc00;
            --hex-border: #e5e5ea;
            --bg-page: #f2f2f7;
            --gold-gradient: linear-gradient(145deg, #ffcc00, #ff9500);
            --apple-red: #ff3b30;
            --main-orange: #ff9500; /* НОВЫЙ ЦВЕТ */
        }

        * { -webkit-tap-highlight-color: transparent; box-sizing: border-box; }

        body {
            background: linear-gradient(180deg, #ffffff 0%, var(--bg-page) 100%);
            margin: 0; font-family: -apple-system, system-ui, sans-serif;
            display: flex; flex-direction: column; align-items: center; min-height: 100vh; color: #1c1c1e;
        }

        header {
            width: 100%; background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(20px);
            position: sticky; top: 0; z-index: 1000; padding: 12px 0; border-bottom: 0.5px solid rgba(0,0,0,0.1);
        }

        .stats-container { text-align: center; margin-bottom: 8px; }
        .total-stats { font-size: 10px; font-weight: 800; color: var(--main-orange); text-transform: uppercase; letter-spacing: 1.2px; }
        .streak-info { font-size: 10px; font-weight: 800; color: #34c759; text-transform: uppercase; margin-top: 2px; }

        .nav-header { display: flex; align-items: center; justify-content: space-between; padding: 0 15px; max-width: 600px; margin: 0 auto; }
        .menu-btn { background: none; border: none; font-size: 10px; font-weight: 800; color: #8e8e93; cursor: pointer; text-transform: uppercase; padding: 10px; }
        .book-title { font-size: 18px; font-weight: 900; text-transform: uppercase; color: #000; flex-grow: 1; text-align: center; }

        /* СТИЛЬ ПОЛЗУНКОВ (ОРПНЖЕВЫЙ) */
        .toggle-switch { position: relative; display: inline-block; width: 38px; height: 20px; }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #d1d1d6; transition: .3s; border-radius: 20px; }
        .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 2px; bottom: 2px; background-color: white; transition: .3s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--main-orange); }
        input:checked + .slider:before { transform: translateX(18px); }

        .app-container {
            background: #ffffff; margin: 15px 15px; padding: 35px 10px;
            border-radius: 35px; box-shadow: 0 10px 40px rgba(0,0,0,0.03);
            display: flex; flex-direction: column; align-items: center; min-height: 300px;
        }

        .random-mode-bar {
            margin-bottom: 20px; display: flex; align-items: center; gap: 10px;
            background: #f2f2f7; padding: 8px 15px; border-radius: 20px;
        }

        .menu-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 255, 255, 0.98); z-index: 2000; display: none; flex-direction: column; padding: 60px 20px 20px; overflow-y: auto;
        }

        .filter-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; padding: 12px; background: #f2f2f7; border-radius: 14px; }
        .filter-label { font-size: 10px; font-weight: 800; color: #8e8e93; text-transform: uppercase; }

        .menu-list { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .menu-item {
            padding: 16px 10px; border-radius: 16px; background: #f2f2f7; text-align: center;
            font-size: 11px; font-weight: 800; color: #1c1c1e; text-transform: uppercase;
            display: flex; flex-direction: column; transition: all 0.2s ease;
        }
        .menu-item.in-progress { background: var(--gold-gradient); color: #fff; }
        .menu-item.completed { border: 1px solid var(--main-orange); opacity: 0.6; }

        .grid-wrapper { line-height: 0; display: inline-block; transition: opacity 0.3s; }
        .hex-row { white-space: nowrap; margin-top: calc(var(--hex-h) * -0.26); display: block; }
        .hex-row:nth-child(even) { margin-left: calc(var(--hex-w) / 2 + var(--hex-gap) + 1px); }

        .hexagon {
            width: var(--hex-w); height: var(--hex-h); display: inline-block; margin: var(--hex-gap);
            position: relative; background: var(--hex-border);
            clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);
        }
        .hexagon.animate { animation: hexPop 0.4s forwards; opacity: 0; }
        @keyframes hexPop { from { opacity: 0; transform: scale(0); } to { opacity: 1; transform: scale(1); } }

        .hexagon-inner {
            position: absolute; top: 1.5px; left: 1.5px; right: 1.5px; bottom: 1.5px;
            background: #ffffff; clip-path: inherit; display: flex; align-items: center; justify-content: center;
            font-size: 13px; font-weight: 700;
        }
        .checked .hexagon-inner { background: var(--gold-gradient); color: #ffffff; }

        .info-panel { margin-top: 5px; text-align: center; padding-bottom: 30px; }
        .reset-btn { color: var(--apple-red); font-size: 9px; font-weight: 800; border: none; background: none; cursor: pointer; opacity: 0.3; text-transform: uppercase; }
    </style>
</head>
<body>

    <header>
        <div class="stats-container">
            <div class="total-stats" id="total-stats">ПРОГРЕСС: 0 / 1189</div>
            <div class="streak-info" id="streak-info">УДАРНЫЙ РЕЖИМ: 0 ДНЕЙ</div>
        </div>
        <div class="nav-header">
            <button class="menu-btn" onclick="toggleMenu('old-menu')">ветхий</button>
            <div class="book-title" id="book-name">БЫТИЕ</div>
            <button class="menu-btn" onclick="toggleMenu('new-menu')">новый</button>
        </div>
    </header>

    <div class="app-container">
        <div class="random-mode-bar">
            <div class="filter-label" style="color: #1c1c1e;">Случайный порядок</div>
            <label class="toggle-switch">
                <input type="checkbox" id="random-shuffle" onchange="toggleShuffle()">
                <span class="slider"></span>
            </label>
        </div>
        <div class="grid-wrapper" id="grid"></div>
    </div>

    <div class="menu-overlay" id="old-menu">
        <button onclick="toggleMenu('old-menu')" style="position:fixed; top:20px; right:20px; border:none; background:none; font-size:24px;">✕</button>
        <div class="filter-bar">
            <div class="filter-label">Скрыть прочитанное</div>
            <label class="toggle-switch">
                <input type="checkbox" id="hide-old" onchange="toggleFilter()">
                <span class="slider"></span>
            </label>
        </div>
        <div class="menu-list" id="old-list"></div>
    </div>

    <div class="menu-overlay" id="new-menu">
        <button onclick="toggleMenu('new-menu')" style="position:fixed; top:20px; right:20px; border:none; background:none; font-size:24px;">✕</button>
        <div class="filter-bar">
            <div class="filter-label">Скрыть прочитанное</div>
            <label class="toggle-switch">
                <input type="checkbox" id="hide-new" onchange="toggleFilter()">
                <span class="slider"></span>
            </label>
        </div>
        <div class="menu-list" id="new-list"></div>
    </div>

    <div class="info-panel">
        <div id="info-text" style="font-size:11px; font-weight:700; color:#8e8e93; text-transform:uppercase;">выберите главу</div>
        <button class="reset-btn" onclick="resetBook()">Сбросить прогресс книги</button>
    </div>

    <script>
        const oldT = [{n:'БЫТИЕ', c:50, id:'gen'},{n:'ИСХОД', c:40, id:'exo'},{n:'ЛЕВИТ', c:27, id:'lev'},{n:'ЧИСЛА', c:36, id:'num'},{n:'ВТОРОЗАКОНИЕ', c:34, id:'deu'},{n:'ИИСУС НАВИН', c:24, id:'jos'},{n:'СУДЬИ', c:21, id:'jdg'},{n:'РУФЬ', c:4, id:'rut'},{n:'1 ЦАРСТВ', c:31, id:'1sa'},{n:'2 ЦАРСТВ', c:24, id:'2sa'},{n:'3 ЦАРСТВ', c:22, id:'1ki'},{n:'4 ЦАРСТВ', c:25, id:'2ki'},{n:'1 ПАРАЛИПОМЕНОН', c:29, id:'1ch'},{n:'2 ПАРАЛИПОМЕНОН', c:36, id:'2ch'},{n:'ЕЗДРА', c:10, id:'ezr'},{n:'НЕЕМИЯ', c:13, id:'neh'},{n:'ЕСФИРЬ', c:10, id:'est'},{n:'ИОВ', c:42, id:'job'},{n:'ПСАЛТИРЬ', c:150, id:'psa'},{n:'ПРИТЧИ', c:31, id:'pro'},{n:'ЕККЛЕСИАСТ', c:12, id:'ecc'},{n:'ПЕСНЯ ПЕСНЕЙ', c:8, id:'sng'},{n:'ИСАИЯ', c:66, id:'isa'},{n:'ИЕРЕМИЯ', c:52, id:'jer'},{n:'ПЛАЧ ИЕРЕМИИ', c:5, id:'lam'},{n:'ИЕЗЕКИИЛЬ', c:48, id:'ezk'},{n:'ДАНИИЛ', c:12, id:'dan'},{n:'ОСИЯ', c:14, id:'hos'},{n:'ИОИЛЬ', c:3, id:'jol'},{n:'АМОС', c:9, id:'amo'},{n:'АВДИЙ', c:1, id:'oba'},{n:'ИОНА', c:4, id:'jon'},{n:'МИХЕЙ', c:7, id:'mic'},{n:'НАУМ', c:3, id:'nam'},{n:'АВВАКУМ', c:3, id:'hab'},{n:'СОФОНИЯ', c:3, id:'zep'},{n:'АГГЕЙ', c:2, id:'hag'},{n:'ЗАХАРИЯ', c:14, id:'zec'},{n:'МАЛАХИЯ', c:4, id:'mal'}];
        const newT = [{n:'МАТФЕЯ', c:28, id:'mat'},{n:'МАРКА', c:16, id:'mrk'},{n:'ЛУКИ', c:24, id:'luk'},{n:'ИОАННА', c:21, id:'jhn'},{n:'ДЕЯНИЯ', c:28, id:'act'},{n:'РИМЛЯНАМ', c:16, id:'rom'},{n:'1 КОРИНФЯНАМ', c:16, id:'1co'},{n:'2 КОРИНФЯНАМ', c:13, id:'2co'},{n:'ГАЛАТАМ', c:6, id:'gal'},{n:'ЕФЕСЯНАМ', c:6, id:'eph'},{n:'ФИЛИППИЙЦАМ', c:4, id:'php'},{n:'КОЛОССЯНАМ', c:4, id:'col'},{n:'1 ФЕССАЛОНИКИЙЦАМ', c:5, id:'1th'},{n:'2 ФЕССАЛОНИКИЙЦАМ', c:3, id:'2th'},{n:'1 ТИМОФЕЮ', c:6, id:'1ti'},{n:'2 ТИМОФЕЮ', c:4, id:'2ti'},{n:'ТИТУ', c:3, id:'tit'},{n:'ФИЛИМОНУ', c:1, id:'phm'},{n:'ЕВРЕЯМ', c:13, id:'heb'},{n:'ИАКОВА', c:5, id:'jas'},{n:'1 ПЕТРА', c:5, id:'1pe'},{n:'2 ПЕТРА', c:3, id:'2pe'},{n:'1 ИОАННА', c:5, id:'1jn'},{n:'2 ИОАННА', c:1, id:'2jn'},{n:'3 ИОАННА', c:1, id:'3jn'},{n:'ИУДЫ', c:1, id:'jud'},{n:'ОТКРОВЕНИЕ', c:22, id:'rev'}];

        let currentB = JSON.parse(localStorage.getItem('last_book')) || oldT[0];
        let hideCompleted = localStorage.getItem('hide_completed') === 'true';
        let isRandomMode = localStorage.getItem('random_mode') === 'true';

        function toggleMenu(id) {
            const m = document.getElementById(id);
            const isOpen = m.style.display === 'flex';
            m.style.display = isOpen ? 'none' : 'flex';
            if(!isOpen) {
                document.getElementById('hide-old').checked = hideCompleted;
                document.getElementById('hide-new').checked = hideCompleted;
                updateUIStats();
            }
        }

        function toggleFilter() {
            hideCompleted = !hideCompleted;
            localStorage.setItem('hide_completed', hideCompleted);
            updateUIStats();
        }

        function toggleShuffle() {
            isRandomMode = document.getElementById('random-shuffle').checked;
            localStorage.setItem('random_mode', isRandomMode);
            render();
        }

        function updateUIStats() {
            let total = 0;
            [...oldT, ...newT].forEach(b => {
                const saved = JSON.parse(localStorage.getItem('bible_v3_' + b.id)) || [];
                total += saved.length;
                const item = document.getElementById('item-' + b.id);
                if(item) {
                    const isDone = saved.length === b.c;
                    const percent = Math.round((saved.length / b.c) * 100);
                    item.classList.toggle('completed', isDone);
                    item.classList.toggle('in-progress', saved.length > 0 && !isDone);
                    item.style.display = (hideCompleted && isDone) ? 'none' : 'flex';
                    item.querySelector('span').innerText = `${saved.length} / ${b.c} • ${percent}%`;
                }
            });
            document.getElementById('total-stats').innerText = `ПРОГРЕСС: ${total} / 1189`;
        }

        function build() {
            const lists = { 'old-list': oldT, 'new-list': newT };
            for (let id in lists) {
                const container = document.getElementById(id); container.innerHTML = '';
                lists[id].forEach(b => {
                    const d = document.createElement('div');
                    d.className = 'menu-item'; d.id = 'item-' + b.id;
                    d.innerHTML = `${b.n} <span style="font-size:9px; opacity:0.6; margin-top:4px;">0 / ${b.c} • 0%</span>`;
                    d.onclick = () => { currentB = b; localStorage.setItem('last_book', JSON.stringify(b)); toggleMenu(id.replace('-list','-menu')); render(); };
                    container.appendChild(d);
                });
            }
            document.getElementById('random-shuffle').checked = isRandomMode;
        }

        function render() {
            document.getElementById('book-name').innerText = currentB.n;
            const g = document.getElementById('grid'); g.style.opacity = '0';
            setTimeout(() => {
                g.innerHTML = '';
                const saved = JSON.parse(localStorage.getItem('bible_v3_' + currentB.id)) || [];
                let chapters = Array.from({length: currentB.c}, (_, i) => i + 1);
                if (isRandomMode) chapters.sort(() => Math.random() - 0.5);

                for (let i = 0; i < chapters.length; i += 7) {
                    const row = document.createElement('div'); row.className = 'hex-row';
                    chapters.slice(i, i + 7).forEach((num, index) => {
                        const h = document.createElement('div');
                        h.className = 'hexagon animate' + (saved.includes(num) ? ' checked' : '');
                        h.style.animationDelay = (index * 0.04) + 's';
                        h.innerHTML = `<div class="hexagon-inner">${num}</div>`;
                        h.onclick = () => {
                            if (window.navigator.vibrate) window.navigator.vibrate(15);
                            let p = JSON.parse(localStorage.getItem('bible_v3_' + currentB.id)) || [];
                            if(h.classList.toggle('checked')) p.push(num); else p = p.filter(x => x !== num);
                            localStorage.setItem('bible_v3_' + currentB.id, JSON.stringify(p));
                            updateUIStats();
                        };
                        row.appendChild(h);
                    });
                    g.appendChild(row);
                }
                g.style.opacity = '1'; updateUIStats();
            }, 150);
        }

        function resetBook() { if(confirm('Сбросить прогресс книги?')) { localStorage.removeItem('bible_v3_'+currentB.id); render(); } }

        build(); render();
        if ('serviceWorker' in navigator) navigator.serviceWorker.register('./sw.js');
    </script>
</body>
</html>